<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staywarm jacket product web page</title>
    <style>#logo{
  width: 100%;
}
#buttonsContainer{
  display: flex;
  justify-content: center;
  gap: 35px;
  margin: 0px;
}
#loginButton, #signUpButton{
  border-radius: 20px;
  background-color: white;
  padding: 5px;
  margin-top: 15px;
  margin-bottom: 15px;
  width: 80px;
  height: 30px;
}
#navBar{
  margin: 10px;
  padding: 0;
}
#navBarList{
  list-style-type: none;
  display: flex;
  justify-content: center;
  gap: 15px;
  margin: 0;
  padding: 0;
  background-color: none;
}
#navBarList li a{
  color: black;
  text-decoration: none;
  border-radius: 5px;
  border-color: lightblue;
}
#navBarList li a button{
  border-radius: 5px;
  border-color: lightblue;
  background-color: white;
}
#searchBar{
  width: 75%;
  margin: 0px;
  border-radius: 0px;
}
#searchContainer{
  display: flex;
  justify-content: center;
}
#searchButton{
  background-color: white;
  border-color: solid lightblue;
  border-radius: 0px;
}
.quantity{
  width: 25px;
  height: 15px;
  margin-right: 10px;
  margin-top: 15px;
}
.atc{
  background-color: lightyellow;
  width: 60%;
  border-radius: 5px;
  margin-top: 15px;
}
.cart-container{
  position: fixed;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  transition: height 0.3s ease;
  height: 50px;
  z-index: 1000;
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%;
  background-color: white;
}
.expand-button{
  background-color: white;
  font-size: 25px;
  width: 100px;
}
.cart-items{
  display: none;
  height: 100%;
}
.cart-container.expanded{
  height: 35%;
}
.cart-container.expanded .cart-items{
  display: flex;
  flex-direction: column;
  align-items: center;
  overflow-y: scroll;
}
.deleteCartItem{
  display: flex;
  justify-content: center;
  align-items: center;
  background-color: red;
  border-radius: 5px;
  margin-right: 10px;
}
.rating{
  margin-right: 2px;
}
.rating span{
  color: gray;
}
.rating span.filled{
  color: gold;
}
#promotedItemsContainer{
  margin-top: 50px;
  margin-bottom: 250px;
  display: flex;
  flex-direction: column;
  flex-wrap: wrap;
  justify-content: center;
  align-items: center;
  overflow-y: scroll;
}
#main-container {
  position: relative;
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  width: 100%;
  height: 100%;
}
@media (min-width: 768px) {
  #searchBar {
    width: 50%;
  }
  #promotedItemsContainer {
    flex-direction: row;
    justify-content: center;
    width: 80%;
    margin-left: 25px;
  }
  .cart-container{
  position: static;
  transform: translateX(0%);
  z-index: 1000;
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 300px;
  background-color: white;
  border-radius: 5px;
  border: 2px solid lightblue
  }
  .cart-container.expanded{
  margin-top: 0;
  height: 900px
  }
  #cart-sidebar {
    height: 900px;
  }
}</style>
  </head>
  <body>
    <main>
    <img id="logo" src="https://assets.onecompiler.app/42xjnjtme/42xjmguq8/Gemini_Generated_Image_mgsx28mgsx28mgsx%20(1).jpeg">
    <div id="buttonsContainer">
      <button id="loginButton" onclick='window.location.href="https://crlapples.github.io/Marketplace-project/login.html"'>Login</button>
      <button id="signUpButton" onclick='window.location.href="https://crlapples.github.io/Marketplace-project/signup.html"'>Sign-up</button>
    </div>
    <div id="searchContainer">
      <input id="searchBar" type="text" placeholder="Search for items"><span><a href="https://crlapples.github.io/Marketplace-project/search.html"><button id="searchButton">Search</button></a></span>
    </div>
    <nav id="navBar">
      <ul id="navBarList">
        <li><a href="https://crlapples.github.io/Marketplace-project/index.html"><button>Home</button></a></li>
        <li><a href="https://crlapples.github.io/Marketplace-project/electronics.html"><button>Electronics</button></a></li>
        <li><a href="https://crlapples.github.io/Marketplace-project/clothing.html"><button>Clothing</button></a></li>
        <li><a href="https://crlapples.github.io/Marketplace-project/jewelry.html"><button>Jewelry</button></a></li>
      </ul>
    </nav>
    <div id="main-container">
      <div id="promotedItemsContainer">
      </div>
      <div id="cart-sidebar">
      </div>
    </div>
    <footer>Copyright 2024</footer>
    </main>
    <script>// Create static item to showcase items without db on github pages
    const exampleItems = [{
      title: 'Staywarm Jacket',
    src: 'https://crlapples.github.io/Marketplace-project/jacket.jpeg',
    price: '129.99',
    url: 'example',
    review: '3',
    reviewTotal: '32,500',
    descr: "Hey, I'm the jacket you've been waiting for - flawless fit, chic design, and ready to make you look hot and stay cozy. Whether you're hitting the streets or just stepping out for coffee, I've got you covered in all the right ways. My sleek silhouette hugs you just right, and those pockets? Perfect for keeping your essentials (or your secrets). I'm warm, I'm stylish, and I'm always down for a little adventure. Trust me, you'll be turning heads wherever you go - and let's be real, who wouldn't want to look this good?"
    }];
    document.getElementById('searchButton').addEventListener('click', function() {
    const query = document.getElementById('searchBar').value.trim().toLowerCase();
    localStorage.setItem('lastSearchQuery', query);
    });
    let totalQuantity = 0;
    displayRecommendedItems(exampleItems);
    function sliceText(text){
      const words = text.split(' ');
      const slicedText = words.slice(0, 15).join(' ');
      return slicedText;
    }
    function displayRecommendedItems(items){
  items.forEach(item => { 
    const createdDiv1 = document.createElement('div');
    const createdDiv2 = document.createElement('div');
    const createdDiv3 = document.createElement('div');
    const createdImg = document.createElement('img');
    const createdP = document.createElement('p');
    const createdSpan1 = document.createElement('span');
    const createdSpan2 = document.createElement('span');
    const createdH2 = document.createElement('h2');
    const quantityInput = document.createElement('input');
    const div5 = document.createElement('div');
    const title = document.createElement('h2');
    const rating = document.createElement('p');
    const totalRatings = document.createElement('p');
    const span3 = document.createElement('span');
    span3.style.display = 'flex';
    span3.style.alignItems = 'left';
    div5.style.display = 'flex';
    div5.style.alignItems = 'left';
    div5.style.marginBottom = '-10px';
    div5.style.justifyContent = 'center';
    title.textContent = item.title;
    totalRatings.textContent = `(${item.reviewTotal})`;
    rating.classList.add('rating');
    for(let i = 0; i < 5; i++){
      const span = document.createElement('span');
      span.textContent = '★';
      if(i < Number(item.review)){
        span.classList.add('filled');
      }
      rating.appendChild(span);
    }
    quantityInput.classList.add('quantity');
    quantityInput.value = 1;
    quantityInput.type = 'number';
    quantityInput.min = 1;
    const div4 = document.createElement('div');
    createdImg.src = item.src;
    createdP.textContent = item.descr;
    createdH2.textContent = `$${item.price}`;
    if (window.innerWidth > 768) {
      document.getElementById('promotedItemsContainer').appendChild(createdDiv3);
      createdDiv3.appendChild(div5);
      createdDiv3.appendChild(createdDiv1);
      createdDiv3.appendChild(createdP);
      createdDiv3.style.display = 'flex';
      createdDiv3.style.flexDirection = 'column';
      createdDiv3.style.justifyContent = 'center';
      createdDiv3.style.alignItems = 'center';
      createdDiv3.style.margin = '5px';
    } else {
      document.getElementById('promotedItemsContainer').appendChild(div5);
      document.getElementById('promotedItemsContainer').appendChild(createdDiv1);
      title.style.marginRight = '20px';
    }
    div5.appendChild(title);
    createdDiv1.appendChild(createdImg);
    createdDiv1.appendChild(createdSpan1);
    createdSpan1.appendChild(createdDiv2);
    createdDiv2.appendChild(createdH2);
    createdDiv2.appendChild(span3);
    span3.appendChild(rating);
    span3.appendChild(totalRatings);
//    document.getElementById('promotedItemsContainer').appendChild(createdP);
    div4.style.display = 'flex';
    div4.style.alignItems = 'left';
    createdDiv2.appendChild(div4);
    div4.appendChild(quantityInput);
    createdDiv1.style.display = 'flex';
    createdDiv1.style.flexDirection = 'row';
    createdDiv1.style.justifyContent = 'center';
    createdDiv1.style.alignItems = 'center';
    createdDiv2.style.display = 'flex';
    createdDiv2.style.flexDirection = 'column';
    createdDiv2.style.justifyContent = 'center';
    createdDiv2.style.alignItems = 'left';
    if (window.innerWidth < 768) {
      createdDiv1.style.width = '75%';
      createdDiv2.style.width = '100%';
      createdImg.style.width = '50%';
      createdDiv2.style.marginLeft = '10px';
    } else {
      div5.style.transform = 'scale(0.8)';
      div5.style.transformOrigin = 'top left';
      div5.style.marginLeft = '10%';
      createdDiv1.style.width = '250px';
      createdDiv2.style.width = '250px';
      createdImg.style.width = '250px';
      createdP.style.width = '450px';
    }
    createdDiv2.style.marginLeft = '10px';
    createdDiv2.style.padding = '15px';
    const atcButton = document.createElement('button');
    atcButton.textContent = 'add to cart';
    atcButton.classList.add('atc');
    div4.appendChild(atcButton);
    atcButton.addEventListener('click', function(){
      let cartContainer = document.querySelector('.cart-container');
      if(!cartContainer) {
        cartContainer = document.createElement('div');
        const expandButton = document.createElement('button');
        const cartItems = document.createElement('div');
        const checkoutButton = document.createElement('button');
        const totalCartQuantity = document.createElement('p');
        totalCartQuantity.classList.add('totalCartQuantity');
        checkoutButton.textContent = 'Checkout';
        checkoutButton.style.borderRadius = '5px';
        checkoutButton.style.borderColor = 'lightblue';
        checkoutButton.addEventListener('click', function(){
          window.location.href = 'https://crlapples.github.io/Marketplace-project/checkout.html';
        });
        const div6 = document.createElement('div');
        div6.style.display = 'flex';
        div6.style.alignItems = 'center';
        div6.style.gap = '30px';
        if (window.innerWidth < 768) {
          document.body.appendChild(cartContainer);
          cartContainer.appendChild(div6);
          cartContainer.appendChild(cartItems);
        } else {
          document.getElementById("cart-sidebar").appendChild(cartContainer);
          cartContainer.appendChild(div6);
          cartContainer.appendChild(cartItems);
        }
        div6.appendChild(checkoutButton);
        div6.appendChild(expandButton);
        div6.appendChild(totalCartQuantity);
        cartContainer.classList.add('cart-container');
        expandButton.classList.add('expand-button');
        if (window.innerWidth < 768) {
          expandButton.textContent = '↑';
        } else {
          expandButton.textContent = '↓';
        }
        expandButton.addEventListener('click', function(){
          cartContainer.classList.toggle('expanded');
        });
      }
      const cartItems = cartContainer.querySelector('.cart-items') || document.createElement('div');
      cartItems.classList.add('cart-items');
      const quantity = parseInt(quantityInput.value, 10);
      totalQuantity = quantity + totalQuantity;
      const totalCart = document.querySelector('.totalCartQuantity');
      const img = document.createElement('img');
        const div = document.createElement('div');
        const h2 = document.createElement('h2');
        const p = document.createElement('p');
        const p2 = document.createElement('p');
        p2.textContent = `x${quantity}`;
        div.appendChild(h2);
        div.appendChild(p2);
        div.appendChild(p);
        img.src = item.src;
        h2.textContent = `$${item.price}`;
        p.textContent = item.title;
        img.style.width = '25%';
        div.style.marginLeft = '10px';
        div.style.display = 'flex';
        div.style.flexDirection = 'column';
        const div3 = document.createElement('div');
        div3.style.display = 'flex';
        div3.style.alignItems = 'center';
        cartItems.appendChild(div3);
        div3.appendChild(img);
        div3.appendChild(div);
        div3.style.justifyContent = 'center';
        div3.style.border = 'none';
        const deleteItem = document.createElement('button');
        deleteItem.textContent = 'x';
        deleteItem.classList.add('deleteCartItem');
        div3.appendChild(deleteItem);
        div3.style.marginLeft = '10px';
        deleteItem.addEventListener('click', function() {
          div3.remove();
          totalQuantity -= quantity;
          const totalCart = document.querySelector('.totalCartQuantity');
          totalCart.textContent = `Cart(${totalQuantity})`;
          let cart = getCartFromLocalStorage();
          const itemIndex = cart.findIndex(cartItem => cartItem.title === item.title && cartItem.quantity === item.quantity);
          if(itemIndex !== -1){
            cart.splice(itemIndex, 1);
          }
          saveCartToLocalStorage(cart);
        });
        cartItems.appendChild(div3);
        cartContainer.appendChild(cartItems);
        totalCart.textContent = `Cart(${totalQuantity})`;
        item.quantity = `${quantity}`;
        const cart = getCartFromLocalStorage();
        cart.push(item);
        saveCartToLocalStorage(cart);
    });
  });
}
function getCartFromLocalStorage(){
  const cart = localStorage.getItem('cart');
  return cart ? JSON.parse(cart) : [];
}
function saveCartToLocalStorage(cart){
  localStorage.setItem('cart', JSON.stringify(cart));
}
function updateCartDisplay(items){
  let sum = 0;
  if(!items || items.length === 0 || items === []) {
    if(cartContainer){
      cartContainer.remove();
    }
    return;
  };
    let cartContainer = document.querySelector('.cart-container');
      if(!cartContainer) {
        cartContainer = document.createElement('div');
        cartContainer.classList.add('cart-container');
        const expandButton = document.createElement('button');
        const cartItems = document.createElement('div');
        const checkoutButton = document.createElement('button');
        const totalCartQuantity = document.createElement('p');
        totalCartQuantity.classList.add('totalCartQuantity');
        checkoutButton.textContent = 'Checkout';
        checkoutButton.style.borderRadius = '5px';
        checkoutButton.style.borderColor = 'lightblue';
        checkoutButton.addEventListener('click', function(){
          window.location.href = 'https://crlapples.github.io/Marketplace-project/checkout.html';
        });
        const div6 = document.createElement('div');
        div6.style.display = 'flex';
        div6.style.alignItems = 'center';
        div6.style.gap = '30px';
        if (window.innerWidth < 768) {
          document.body.appendChild(cartContainer);
          cartContainer.appendChild(div6);
          cartContainer.appendChild(cartItems);
        } else {
          document.getElementById("cart-sidebar").appendChild(cartContainer);
          cartContainer.appendChild(div6);
          cartContainer.appendChild(cartItems);
        }
        div6.appendChild(checkoutButton);
        div6.appendChild(expandButton);
        div6.appendChild(totalCartQuantity);
        cartContainer.classList.add('cart-container');
        expandButton.classList.add('expand-button');
        if (window.innerWidth < 768) {
          expandButton.textContent = '↑';
        } else {
          expandButton.textContent = '↓';
        }
        expandButton.addEventListener('click', function(){
          cartContainer.classList.toggle('expanded');
        });
        totalCartQuantity.textContent = `Cart(${totalQuantity})`;
      }
      const cartItems = cartContainer.querySelector('.cart-items') || document.createElement('div');
      cartItems.classList.add('cart-items');
      items.forEach(item => {
        const quantity = parseInt(item.quantity, 10) || 1;
      totalQuantity = quantity + totalQuantity;
      item.descr = sliceText(item.descr);
      const totalCart = document.querySelector('.totalCartQuantity');
      const img = document.createElement('img');
        const div = document.createElement('div');
        const h2 = document.createElement('h2');
        const p = document.createElement('p');
        const p2 = document.createElement('p');
        p2.textContent = `x${quantity}`;
        div.appendChild(h2);
        div.appendChild(p2);
        div.appendChild(p);
        img.src = item.src;
        h2.textContent = `$${item.price}`;
        p.textContent = item.title;
        img.style.width = '25%';
        div.style.marginLeft = '10px';
        div.style.display = 'flex';
        div.style.flexDirection = 'column';
        const div3 = document.createElement('div');
        div3.style.display = 'flex';
        div3.style.alignItems = 'center';
        cartItems.appendChild(div3);
        div3.appendChild(img);
        div3.appendChild(div);
        div3.style.justifyContent = 'center';
        div3.style.border = 'none';
        const deleteItem = document.createElement('button');
        deleteItem.textContent = 'x';
        deleteItem.classList.add('deleteCartItem');
        div3.appendChild(deleteItem);
        div3.style.marginLeft = '10px';
        deleteItem.addEventListener('click', function() {
          div3.remove();
          totalQuantity -= quantity;
          const totalCart = document.querySelector('.totalCartQuantity');
          totalCart.textContent = `Cart(${totalQuantity})`;
          let cart = getCartFromLocalStorage();
          const itemIndex = cart.findIndex(cartItem => cartItem.title === item.title && cartItem.quantity === item.quantity);
          if(itemIndex !== -1){
            cart.splice(itemIndex, 1);
          }
          saveCartToLocalStorage(cart);
        });
        cartItems.appendChild(div3);
        cartContainer.appendChild(cartItems);
        totalCart.textContent = `Cart(${totalQuantity})`;
  });
}
const cart = getCartFromLocalStorage();
updateCartDisplay(cart);
document.addEventListener('DOMContentLoaded', async function(){ 
  try {
  const response = await fetch('/api/recommended');
  const recommendedItems = await response.json();
  displayRecommendedItems(recommendedItems);
  } catch(error) {
    console.error('Error fetching the recommended items', error)
  }
});
document.getElementById('searchButton').addEventListener('click', async function() {
  const currentSearched = document.getElementById('searchBar').value;
  const response = await fetch('/api/search', {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({query: currentSearched})
  });
});
const elements = document.querySelectorAll('div, li, p, header, span');
const textBlocks = [];
elements.forEach((el, index) => {
  let textBlock = el.innerText.trim();
  if(textBlock.length > 0){
    textBlocks.push(textBlock);
  }
});
async function sendPageText() {
  try {
  const response = await fetch('/api/pageText', {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({query: textBlocks})
    });
  } catch(error) {
      console.error('Error sending webpage all text', error);
  }
}
sendPageText();</script>
  </body>
  </html>
